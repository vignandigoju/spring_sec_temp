import apiClient from './apiClient';

// Example utility to always resolve to an object with error if any
async function safeRequest(promise) {
  try {
    const res = await promise;
    return { data: res.data, status: res.status };
  } catch (err) {
    console.error('[API ERROR]', err);
    // Try to extract API error information; fallback to err.message
    let message = err?.response?.data?.message || err.message || 'Unknown error';
    return { data: { error: message }, status: err?.response?.status || 500, error: message };
  }
}

const apiService = {
  getServices:    () => safeRequest(apiClient.get('core/services')),
  getSpec:        (openApiUrl) => safeRequest(apiClient.get(`core/info/${openApiUrl}`)),
  executeOperation: (config) => safeRequest(apiClient({ ...config, url: `core/execute/${config.serviceId}${config.path}` })),
  getTaskStatus:  (taskEndpoint) => safeRequest(apiClient.get(taskEndpoint)),
  getHistory:     (filters) => safeRequest(apiClient.get('history/list', { params: filters })),
  getPending:     () => safeRequest(apiClient.get('history/pending')),
  getFavorites:   () => safeRequest(apiClient.get('favorites/list')),
  addFavorite:    (applicationid) => safeRequest(apiClient.post('favorites/add', { applicationid })),
  removeFavorite: (applicationid) => safeRequest(apiClient.post('favorites/remove', { applicationid })),
  getDynamicUrl:  (url) => safeRequest(apiClient.get(url))
};

export default apiService;
